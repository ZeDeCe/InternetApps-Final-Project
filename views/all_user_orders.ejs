<!DOCTYPE html>
<html>
    <head>
        <%- include('./partials/head', {title: "Website: Personal Page"}); %>
    </head>
    <body class="bg-light">
        <%- include('./partials/header'); %>
        <div class="position-relative w-100 main-div">
            <div class="w-100 mt-5 position-absolute top-50 start-50 h-100 translate-middle">
                <div class="row justify-content-center">
                    <!--User page main tab-->
                    <div class="col-8 p-0">
                        <div class="mx-2 p-3 bg-white">
                            
                            <div class="row">
                                <div class="col-2 d-flex align-items-center">
                                    <b>Viewing orders placed in</b>
                                </div>
                                <div class="col-2">
                                    <select class="form-select" aria-label="Default select example" id="dateSearch">
                                        <option value="all" selected>All time</option>
                                        <option value="7d">Last 7 days</option>
                                        <option value="30d">Last 30 days</option>
                                        <option value="3m">Last 3 months</option>
                                    </select> <!--TODO: add select button to filter orders by time. for ADMIN add filter by user-->
                                </div>
                                <% if(isAdmin) {%>
                                <div class="col-2">
                                    <div class="input-group flex-nowrap">
                                        <span class="input-group-text" id="addon-wrapping">@</span>
                                        <input id="userSearch" type="text" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="addon-wrapping">
                                      </div>
                                </div>
                                <%}%>
                            </div>
                            <%- include('./partials/ordertable', {userorders: userorders}) %>
                        </div>
                    </div>
                    <!--Re-purchase tab-->
                    <div class="col-2 p-0">
                        <div class="me-2 ms-2 p-3 bg-white">
                            <b>Re-Purchase</b> <!-- TODO: add random items-->
                            <ul class="list-group">
                                <li class="list-group-item bg-transparent border border-0">
                                    ITEM 1
                                </li>
                                <li class="list-group-item bg-transparent border border-0">
                                    ITEM 2
                                </li>
                                <li class="list-group-item bg-transparent border border-0">
                                    ITEM 3
                                </li>
                            </ul>
                        </div> 
                    </div>
                </div>
            </div>
        </div>
        
        <!--Logout button-->
        <script>
            $(document).ready(function(){
                $('#dateSearch').on('change', filterRows)
                $('#userSearch').on('input', filterRows)

                function filterRows() {
                    var option = $('#dateSearch').val();
                    var today = new Date();
                    var startDate;
                    switch (option) {
                        case "3m":
                            startDate = new Date(today.getTime() - 3 * 30 * 24 * 60 * 60 * 1000);
                            break;
                        case "7d":
                            startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                            break;
                        case "30d":
                            startDate = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                            break;
                        default:
                            startDate = new Date(0);
                            break;
                    }
                    <% if(isAdmin) {%> 
                    var userSearch = ($('#userSearch').val()).toLowerCase(); 
                    <%} %>
                    $("[id^=\"singleorder\"]").each(function() {
                        var date = new Date($(this).find('#actualDate').text());
                        
                        <% if(isAdmin) {%>
                        var user = $(this).attr('user').toLowerCase() 
                        <%} %>
                        if(date >= startDate 
                            <% if(isAdmin) {%>
                            && (userSearch === '' || user.includes(userSearch))
                            <%}%>
                        ) {
                            $(this).show()
                        } else {
                            $(this).hide()
                        }
                    })
                }
            })
        </script>
        <%- include('./partials/footer'); %>
    </body>
</html>