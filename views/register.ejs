<!DOCTYPE html>
<html>
    <head>
        <%- include('./partials/head', {title: "Website: Sign-In"}); %>
    </head>
    <body class="bg-dark p-5 mb-2">
        <div class="main-div parent container border border-secondary-subtle border-2 text-start position-absolute top-50 start-50 translate-middle d-flex flex-column justify-content-top align-items-center parent container rounded bg-light-subtle bg-gradient p-4" style="width: 35%; height: 70%; min-width: 500px; min-height:600px">
            <div class="w-100 h-100">
                <h1 class="text-start pl-1">
                    Create your account
                </h1>
                <div id="user-tab" class="tab">
                    <div class="form-data mt-1">
                        <label for="username">Username</label>
                        <input type="text" id="username" class="form-control" name="username" autofocus="autofocus" placeholder="Your username">
                    </div>
                    <div class="form-data mt-1">
                        <label for="name">Your name</label>
                        <input type="text" id="name" class="form-control" name="name" placeholder="First and last name">
                    </div>
                    <div class="form-data mt-1">
                        <label for="email">Your email</label>
                        <input type="text" id="email" class="form-control" name="email" placeholder="youremail@email.com">
                    </div>
                    <div class="form-data mt-1">
                        <label for="password">Password</label>
                        <div class="input-group mt-2 align-items-center">
                            <input type="password" id="password" class="form-control" name="password" placeholder="At least 6 characters">
                            <button class="bi bi-eye-slash btn btn-outline-secondary" type="button" id="togglePasswordDisplay"></button>
                        </div>
                    </div>
                    <div class="form-data mt-1">
                        <label for="password-again">Re-enter password</label>
                        <input type="password" id="password-again" class="form-control" name="password-again" placeholder="One more time">
                    </div>
                    <br>
                    <button id="create" class="btn btn-warning w-100">Create account</button>
                    <br>
                    <p id="errormsg" class="fw-bold text-danger d-none">Error</p>
                    <div class="mt-2">
                        By continuing, you agree to Website's <a href="/policies?page=conditions_of_use">Conditions of Use</a> and <a href="/policies?page=privacy_policy">Privacy Notice</a>
                    </div>
                    <br><br>
                    <div id="register" class="text-center position-absolute bottom-0 start-50 translate-middle">
                        Already have an account?
                        <a href="/login">Sign in</a>
                    </div>
                </div>
            </div>
        </div>
        <script>
            function displayError(msg) {
                $("#errormsg").text(msg).removeClass("d-none")
            }
            $(document).ready(function(){
                current = "bi-eye-slash"
                $("#togglePasswordDisplay").click(function() {
                    old = current
                    current = current == "bi-eye-slash" ? "bi-eye" : "bi-eye-slash"
                    passwordType = current == "bi-eye-slash" ? "password" : "text"
                    $(this).removeClass(old);
                    $(this).addClass(current);
                    $("#password").attr("type", passwordType);
                    $("#password-again").attr("type", passwordType);
                })
                $("#create").click(function() {
                    username = $("#username").val()
                    email = $("#email").val()
                    password = $("#password").val()
                    passagain = $("#password-again").val()
                    name = $("#name").val()
                    if (password != passagain) {
                        displayError("Passwords do not match!");
                        return
                    }
                    $.post('/login/register', {username, password, name, email}).done(function(data) {
                        if(data == "Success") {
                            $.post('/login', {username, password})
                            location.href = "/"
                        }
                        else {
                            for (var e in data) {
                                displayError(data[e].message); // We'll display the first error out of the bunch
                                return
                            }
                            
                        }
                    })
                })
                $(document).on('keypress',function(e) {
                    if(e.which == 13) { // Pressed enter
                        $("#create").click()
                    }
                });
            })
        </script>
    </body>
</html>